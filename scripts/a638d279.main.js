var PONG={stageWidth:600,stageHeight:446,currentScreen:null,screens:{INTRO_SCREEN:"INTRO_SCREEN",GAME_SCREEN:"GAME_SCREEN",GAME_OVER_SCREEN:"GAME_OVER_SCREEN"},event:{START:"START",DIE:"DIE",START_OVER:"START_OVER"},categories:{BACKGROUND:"BACKGROUND",GAME_ENTITIES:"GAME_ENTITIES",PLAYER1_POINTS:"PLAYER1_POINTS",PLAYER2_POINTS:"PLAYER2_POINTS",INTRO:"INTRO",OUTRO:"OUTRO"},displayList:[]};PONG.vars={rotationX:180,rotationY:0,rotationZ:0,translX:0,translY:0,translZ:-493,fieldOfViewRadians:70},PONG.animation={goToSide:function(a){var b=new TimelineLite;b.to(PONG.vars,1,{rotationX:120}).to(PONG.vars,1,{rotationX:110,rotationZ:-90,onComplete:a})},goToFront:function(){var a=new TimelineLite;a.to(PONG.vars,.5,{rotationX:120,rotationZ:0}).to(PONG.vars,.5,{rotationX:180})}},PONG.DomRenderer=function(){var a,b=document.body,c=function(){a=document.createElement("div"),a.style.position="relative",b.appendChild(a)}(),d=function(b){var c=document.createElement("div");return c.style.position="absolute",c.style.left=b.x+"px",c.style.top=b.y+"px",c.style.width=b.width+"px",c.style.height=b.height+"px",c.style.backgroundColor=b.color,a.appendChild(c),c},e=function(){$(a).html("");for(var b=0;b<PONG.displayList.length;b++)for(var c=0,e=PONG.displayList[b].graphics.length;e>c;c++)d(PONG.displayList[b].graphics[c])};return{init:c,drawRect:d,render:e}},PONG.CanvasRenderer=function(){var a,b,c=document.body,d=function(){a=document.createElement("canvas"),a.setAttribute("width",PONG.stageWidth+"px"),a.setAttribute("height",PONG.stageHeight+"px"),b=a.getContext("2d"),console.log(b),c.appendChild(a)}(),e=function(a){var c;return b.fillStyle=a.color,c=b.fillRect(a.x,a.y,a.width,a.height)},f=function(){b.clearRect(0,0,PONG.stageWidth,PONG.stageHeight);for(var a=0;a<PONG.displayList.length;a++)for(var c=0,d=PONG.displayList[a].graphics.length;d>c;c++)e(PONG.displayList[a].graphics[c])};return{init:d,drawRect:e,render:f}},PONG.WebGLRenderer=function(){var a,b,c,d,e,f,g,h,i,j;return rectToVertices=function(a){var b=a.x,c=a.x+a.width,d=a.y,e=a.y+a.height;return[b,d,c,d,b,e,b,e,c,d,c,e]},getShader=function(a,b){var c=document.getElementById(b);if(!c)return null;for(var d="",e=c.firstChild;e;)3==e.nodeType&&(d+=e.textContent),e=e.nextSibling;var f;if("x-shader/x-fragment"==c.type)f=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=c.type)return null;f=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(f,d),a.compileShader(f),a.getShaderParameter(f,a.COMPILE_STATUS)?f:(alert(a.getShaderInfoLog(f)),null)},initEntityBuffer=function(a){var c=[];a.buffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,a.buffer);for(var d=0,e=a.graphics.length;e>d;d++)c=c.concat(rectToVertices(a.graphics[d]));b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW),a.buffer.numItems=.5*c.length},make2DProjection=function(a,b){return[2/a,0,0,0,-2/b,0,-1,1,1]},init=function(){var k;a=document.createElement("canvas"),a.setAttribute("width",window.innerWidth+"px"),a.setAttribute("height",window.innerHeight+"px"),document.body.appendChild(a);try{b=a.getContext("experimental-webgl")}catch(l){}if(!b)return alert("Could not initialise WebGL, sorry :-("),!1;b.viewportWidth=a.width,b.viewportHeight=a.height,c=getShader(b,"2d-vertex-shader"),d=getShader(b,"shader-fs"),e=b.createProgram(),b.attachShader(e,c),b.attachShader(e,d),b.linkProgram(e),b.getProgramParameter(e,b.LINK_STATUS)||alert("Could not initialise shaders"),b.useProgram(e),i=b.getUniformLocation(e,"u_resolution"),f=b.getAttribLocation(e,"a_position"),g=b.getUniformLocation(e,"u_color"),h=b.getUniformLocation(e,"u_matrix"),k=PONG.EntityCollection.pull();for(var m=0,n=k.length;n>m;m++)initEntityBuffer(k[m]);j=make2DProjection(a.width,a.height)}(),getTranslationMatrix=function(a){var b=a[0],c=a[1];return[1,0,0,0,1,0,b,c,1]},getRotationMatrix=function(a){var b=a[0],c=a[1];return[c,-b,0,b,c,0,0,0,1]},getScaleMatrix=function(a){var b=a[0],c=a[1];return[b,0,0,0,c,0,0,0,1]},matrix3x3Multiply=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return[c*l+d*o+e*r,c*m+d*p+e*s,c*n+d*q+e*t,f*l+g*o+h*r,f*m+g*p+h*s,f*n+g*q+h*t,i*l+j*o+k*r,i*m+j*p+k*s,i*n+j*q+k*t]},drawEntities=function(a){for(var c=0,d=a.length;d>c;c++){var e,i;e=a[c].buffer,b.bindBuffer(b.ARRAY_BUFFER,e),b.uniform4f(g,a[c].rgba.r/255,a[c].rgba.g/255,a[c].rgba.b/255,a[c].rgba.a/255),i=matrix3x3Multiply(getScaleMatrix(a[c].scale),getTranslationMatrix(a[c].translation)),i=matrix3x3Multiply(i,getRotationMatrix(a[c].rotation)),i=matrix3x3Multiply(i,j),b.uniformMatrix3fv(h,!1,i),b.vertexAttribPointer(f,2,b.FLOAT,!1,0,0),b.enableVertexAttribArray(f),b.drawArrays(b.TRIANGLES,0,e.numItems)}},render=function(){b.clear(b.COLOR_BUFFER_BIT),drawEntities(PONG.displayList)},{init:init,render:render}},PONG.WebGL3DRenderer=function(){var a,b,c,d,e,f,g,h,i;return rectToVertices=function(a){var b=a.x,c=a.x+a.width,d=a.y,e=a.y+a.height,f=a.depth;return[b,d,0,c,d,0,b,e,0,b,e,0,c,d,0,c,e,0,c,d,f,b,d,f,c,e,f,c,e,f,b,d,f,b,e,f,b,d,f,c,d,f,b,d,0,b,d,0,c,d,f,c,d,0,c,e,f,b,e,f,c,e,0,c,e,0,b,e,f,b,e,0,b,d,0,b,e,0,b,d,f,b,d,f,b,e,0,b,e,f,c,d,0,c,d,f,c,e,0,c,e,0,c,d,f,c,e,f]},getShader=function(a,b){var c=document.getElementById(b);if(!c)return null;for(var d="",e=c.firstChild;e;)3==e.nodeType&&(d+=e.textContent),e=e.nextSibling;var f;if("x-shader/x-fragment"==c.type)f=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=c.type)return null;f=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(f,d),a.compileShader(f),a.getShaderParameter(f,a.COMPILE_STATUS)?f:(alert(a.getShaderInfoLog(f)),null)},initEntityBuffer=function(a){var c=[];a.buffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,a.buffer);for(var d=0,e=a.graphics.length;e>d;d++)c=c.concat(rectToVertices(a.graphics[d]));b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW),a.buffer.numItems=c.length/3},init=function(){var j;a=document.createElement("canvas"),a.setAttribute("width",window.innerWidth+"px"),a.setAttribute("height",window.innerHeight+"px"),document.body.appendChild(a);try{b=a.getContext("experimental-webgl")}catch(k){}if(!b)return alert("Could not initialise WebGL, sorry :-("),!1;b.viewportWidth=a.width,b.viewportHeight=a.height,h=a.width/a.height,c=getShader(b,"3d-vertex-shader"),d=getShader(b,"shader-fs"),e=b.createProgram(),b.attachShader(e,c),b.attachShader(e,d),b.linkProgram(e),b.getProgramParameter(e,b.LINK_STATUS)||alert("Could not initialise shaders"),b.useProgram(e),f=b.getAttribLocation(e,"a_position"),g=b.getUniformLocation(e,"u_color"),i=b.getUniformLocation(e,"u_matrix"),j=PONG.EntityCollection.pull();for(var l=0,m=j.length;m>l;l++)initEntityBuffer(j[l]);b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST)}(),getTranslationMatrix=function(a){var b=a[0],c=a[1],d=a[2];return[1,0,0,0,0,1,0,0,0,0,1,0,b,c,d,1]},getXRotationMatrix=function(a){var b=a[0],c=a[1];return[1,0,0,0,0,c,b,0,0,-b,c,0,0,0,0,1]},getYRotationMatrix=function(a){var b=a[0],c=a[1];return[c,0,-b,0,0,1,0,0,b,0,c,0,0,0,0,1]},getZRotationMatrix=function(a){var b=a[0],c=a[1];return[c,b,0,0,-b,c,0,0,0,0,1,0,0,0,0,1]},getScaleMatrix=function(a){var b=a[0],c=a[1],d=a[2];return[b,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1]},makeZToWMatrix=function(a){return[1,0,0,0,0,1,0,0,0,0,1,a,0,0,0,1]},makePerspective=function(a,b,c,d){var e=Math.tan(.5*Math.PI-.5*a),f=1/(c-d);return[e/b,0,0,0,0,e,0,0,0,0,(c+d)*f,-1,0,0,c*d*f*2,0]},matrix4x4Multiply=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14],H=b[15];return[c*s+d*w+e*A+f*E,c*t+d*x+e*B+f*F,c*u+d*y+e*C+f*G,c*v+d*z+e*D+f*H,g*s+h*w+i*A+j*E,g*t+h*x+i*B+j*F,g*u+h*y+i*C+j*G,g*v+h*z+i*D+j*H,k*s+l*w+m*A+n*E,k*t+l*x+m*B+n*F,k*u+l*y+m*C+n*G,k*v+l*z+m*D+n*H,o*s+p*w+q*A+r*E,o*t+p*x+q*B+r*F,o*u+p*y+q*C+r*G,o*v+p*z+q*D+r*H]},getSinCos=function(){var a,b;return[a,b]},drawEntities=function(a){for(var c=0,d=a.length;d>c;c++){var e,j,k,l,m,n,o,p,q,r,s,t;e=a[c].buffer,b.bindBuffer(b.ARRAY_BUFFER,e),b.enableVertexAttribArray(f),b.vertexAttribPointer(f,3,b.FLOAT,!1,0,0),b.uniform4f(g,a[c].rgba.r/255,a[c].rgba.g/255,a[c].rgba.b/255,a[c].rgba.a/255),k=getTranslationMatrix([-300,-223,0]),l=getTranslationMatrix([.5*window.innerWidth,.5*window.innerHeight,.5*window.innerWidth]),m=getTranslationMatrix([PONG.vars.translX,PONG.vars.translY,PONG.vars.translZ]),n=getTranslationMatrix(a[c].translation),o=getXRotationMatrix([Math.sin(PONG.vars.rotationX*Math.PI/180),Math.cos(PONG.vars.rotationX*Math.PI/180)]),p=getYRotationMatrix([Math.sin(PONG.vars.rotationY*Math.PI/180),Math.cos(PONG.vars.rotationY*Math.PI/180)]),q=getZRotationMatrix([Math.sin(PONG.vars.rotationZ*Math.PI/180),Math.cos(PONG.vars.rotationZ*Math.PI/180)]),s=getScaleMatrix(a[c].scale),r=makeZToWMatrix(PONG.vars.fudgeFactor),t=makePerspective(PONG.vars.fieldOfViewRadians*Math.PI/180,h,1,2e3),j=matrix4x4Multiply(k,n),j=matrix4x4Multiply(j,s),j=matrix4x4Multiply(j,q),j=matrix4x4Multiply(j,p),j=matrix4x4Multiply(j,o),j=matrix4x4Multiply(j,m),j=matrix4x4Multiply(j,t),b.uniformMatrix4fv(i,!1,j),b.drawArrays(b.TRIANGLES,0,e.numItems)}},render=function(){b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),drawEntities(PONG.displayList)},{init:init,render:render}},PONG.Rect=function(a,b,c,d,e,f){this._x=a||0,this._y=b||0,this._z=0,this._width=c||0,this._height=d||0,this._depth=13,this._color=e||"#FFFFFF",this._rgba=f||{r:255,g:255,b:255,a:255}},Object.defineProperty(PONG.Rect.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a}}),Object.defineProperty(PONG.Rect.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a}}),Object.defineProperty(PONG.Rect.prototype,"z",{get:function(){return this._z},set:function(a){this._z=a}}),Object.defineProperty(PONG.Rect.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(PONG.Rect.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),Object.defineProperty(PONG.Rect.prototype,"depth",{get:function(){return this._depth},set:function(a){this._depth=a}}),Object.defineProperty(PONG.Rect.prototype,"color",{get:function(){return this._color},set:function(a){this._color=a}}),Object.defineProperty(PONG.Rect.prototype,"rgba",{get:function(){return this._rgba},set:function(a){this._rgba=a}}),PONG.Entity=function(a,b,c,d,e,f){this.graphics=[],this._x=a||0,this._y=b||0,this._z=0,this._width=c||0,this._height=d||0,this._depth=13,this._scale=[1,1,1],this._degree=0,this._rad=0,this._rotation=[0,1],this._color=e||"#FFFFFF",this._rgba=f||{r:255,g:255,b:255,a:255}},Object.defineProperty(PONG.Entity.prototype,"x",{get:function(){return this._x},set:function(a){for(var b=0,c=this.graphics.length;c>b;b++)this.graphics[b].x+=a-this._x;this._x=a}}),Object.defineProperty(PONG.Entity.prototype,"y",{get:function(){return this._y},set:function(a){for(var b=0,c=this.graphics.length;c>b;b++)this.graphics[b].y+=a-this._y;this._y=a}}),Object.defineProperty(PONG.Entity.prototype,"z",{get:function(){return this._z},set:function(a){for(var b=0,c=this.graphics.length;c>b;b++)this.graphics[b].z=a;this._z=a}}),Object.defineProperty(PONG.Entity.prototype,"translation",{get:function(){return[this._x,this._y,this._z]}}),Object.defineProperty(PONG.Entity.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(PONG.Entity.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),Object.defineProperty(PONG.Entity.prototype,"depth",{get:function(){return this._depth},set:function(a){for(var b=0,c=this.graphics.length;c>b;b++)this.graphics[b].depth=a;this._depth=a}}),Object.defineProperty(PONG.Entity.prototype,"degreeRotation",{get:function(){return this._degree},set:function(a){this._degree=a,this._rad=a*Math.PI/180,this._rotation=[Math.sin(this._rad),Math.cos(this._rad)]}}),Object.defineProperty(PONG.Entity.prototype,"radRotation",{get:function(){return this._degree},set:function(a){this._rad=a,this._degree=180*a/Math.PI,this._rotation=[Math.sin(this._rad),Math.cos(this._rad)]}}),Object.defineProperty(PONG.Entity.prototype,"rotation",{get:function(){return this._rotation}}),Object.defineProperty(PONG.Entity.prototype,"scaleX",{get:function(){return this._scale[0]},set:function(a){this._scale[0]=a}}),Object.defineProperty(PONG.Entity.prototype,"scaleY",{get:function(){return this._scale[1]},set:function(a){this._scale[1]=a}}),Object.defineProperty(PONG.Entity.prototype,"scaleZ",{get:function(){return this._scale[2]},set:function(a){this._scale[2]=a}}),Object.defineProperty(PONG.Entity.prototype,"scale",{set:function(a){this._scale=[a,a]},get:function(){return this._scale}}),Object.defineProperty(PONG.Entity.prototype,"color",{get:function(){return this._color},set:function(a){this._color=a}}),Object.defineProperty(PONG.Entity.prototype,"rgba",{get:function(){return this._rgba},set:function(a){this._rgba=a}}),Object.defineProperty(PONG.Entity.prototype,"alpha",{get:function(){return this._rgba.a/255},set:function(a){this._rgba.a=255*a}}),PONG.EntityCollection=function(){var a={"default":[]},b=function(b,c){1==arguments.length?a["default"].push(b):(a.hasOwnProperty(c)||(a[c]=[]),a[c].push(b))},c=function(b){return void 0===b?void 0:a[b]=[]},d=function(b){if(void 0===b){var c=[];for(var d in a)a.hasOwnProperty(d)&&(c=c.concat(a[d]));return c}return a[b]};return{push:b,pull:d,flush:c}}(),PONG.Bound=function(){PONG.Entity.apply(this,arguments),this.width=600,this.height=13,this.z=0,this.graphics=[new PONG.Rect(0,0,this.width,this.height,this.color)],this.depth=26},PONG.Bound.prototype=Object.create(PONG.Entity.prototype),PONG.Bound.prototype.constructor=PONG.Bound,PONG.Point=function(a,b,c){PONG.Entity.apply(this,arguments),this.width=this.height=7,this.x=a,this.y=b,this.graphics=[new PONG.Rect(this.x,this.y,this.width,this.height,this.color)],this.z=c},PONG.Point.prototype=Object.create(PONG.Entity.prototype),PONG.Point.prototype.constructor=PONG.Point,PONG.Scene=function(){PONG.Entity.apply(this,arguments),this.color="#5856D6",this.rgba={r:88,g:86,b:214,a:255},this.graphics=[new PONG.Rect(0,13,600,420,this.color,this.rgba)],this.z=14},PONG.Scene.prototype=Object.create(PONG.Entity.prototype),PONG.Scene.prototype.constructor=PONG.Scene,PONG.Ball=function(){PONG.Entity.apply(this,arguments),this.width=this.height=this.z=13,this.speed={x:-3,y:-2},this.graphics=[new PONG.Rect(0,0,this.width,this.height,this.color)]},PONG.Ball.prototype=Object.create(PONG.Entity.prototype),PONG.Ball.prototype.constructor=PONG.Ball,PONG.Paddle=function(){PONG.Entity.apply(this,arguments),this.width=13,this.height=70,this.graphics=[new PONG.Rect(0,0,this.width,this.height,this.color)]},PONG.Paddle.prototype=Object.create(PONG.Entity.prototype),PONG.Paddle.prototype.constructor=PONG.Paddle,PONG.IntroTitle=function(){PONG.Entity.apply(this,arguments),this.graphics=[new PONG.Rect(0,0,23,71,this.color),new PONG.Rect(23,0,38,13,this.color),new PONG.Rect(23,39,38,13,this.color),new PONG.Rect(49,10,22,32,this.color),new PONG.Rect(78,10,23,51,this.color),new PONG.Rect(127,10,23,51,this.color),new PONG.Rect(88,0,51,13,this.color),new PONG.Rect(88,58,51,13,this.color),new PONG.Rect(156,0,23,71,this.color),new PONG.Rect(205,0,23,71,this.color),new PONG.Rect(179,10,9,32,this.color),new PONG.Rect(185,20,13,32,this.color),new PONG.Rect(195,29,10,32,this.color),new PONG.Rect(234,20,10,32,this.color),new PONG.Rect(244,10,13,51,this.color),new PONG.Rect(254,0,12,23,this.color),new PONG.Rect(266,0,39,13,this.color),new PONG.Rect(254,49,12,22,this.color),new PONG.Rect(266,58,39,13,this.color),new PONG.Rect(283,45,22,13,this.color),new PONG.Rect(273,32,32,13,this.color)],this.z=0},PONG.IntroTitle.prototype=Object.create(PONG.Entity.prototype),PONG.IntroTitle.prototype.constructor=PONG.IntroTitle,PONG.Instruction=function(){PONG.Entity.apply(this,arguments),this.graphics=[new PONG.Rect(0,0,8,19,this.color),new PONG.Rect(15,0,8,19,this.color),new PONG.Rect(3,18,17,4,this.color),new PONG.Rect(26,6,17,4,this.color),new PONG.Rect(24,9,8,4,this.color),new PONG.Rect(27,12,17,4,this.color),new PONG.Rect(39,15,8,4,this.color),new PONG.Rect(24,18,20,4,this.color),new PONG.Rect(48,9,8,10,this.color),new PONG.Rect(51,6,17,4,this.color),new PONG.Rect(63,9,8,7,this.color),new PONG.Rect(56,12,7,4,this.color),new PONG.Rect(51,18,17,4,this.color),new PONG.Rect(96,6,8,16,this.color),new PONG.Rect(111,6,8,16,this.color),new PONG.Rect(99,3,8,4,this.color),new PONG.Rect(108,3,8,4,this.color),new PONG.Rect(102,0,11,4,this.color),new PONG.Rect(104,12,7,4,this.color),new PONG.Rect(147,6,17,4,this.color),new PONG.Rect(159,9,8,13,this.color),new PONG.Rect(147,12,12,4,this.color),new PONG.Rect(144,15,8,4,this.color),new PONG.Rect(147,18,20,4,this.color),new PONG.Rect(168,6,8,16,this.color),new PONG.Rect(176,6,12,4,this.color),new PONG.Rect(183,9,8,13,this.color),new PONG.Rect(192,9,8,10,this.color),new PONG.Rect(195,6,12,4,this.color),new PONG.Rect(207,0,8,22,this.color),new PONG.Rect(195,18,12,4,this.color),new PONG.Rect(240,0,8,22,this.color),new PONG.Rect(248,0,9,4,this.color),new PONG.Rect(252,3,8,4,this.color),new PONG.Rect(255,6,8,10,this.color),new PONG.Rect(252,15,8,4,this.color),new PONG.Rect(248,18,9,4,this.color)],this.z=7},PONG.Instruction.prototype=Object.create(PONG.Entity.prototype),PONG.Instruction.prototype.constructor=PONG.Instruction,PONG.PressEnter=function(){PONG.Entity.apply(this,arguments),this.graphics=[new PONG.Rect(0,0,8,22,this.color),new PONG.Rect(8,0,12,4,this.color),new PONG.Rect(15,3,8,10,this.color),new PONG.Rect(8,12,12,4,this.color),new PONG.Rect(27,6,8,16,this.color),new PONG.Rect(35,9,3,4,this.color),new PONG.Rect(36,6,11,4,this.color),new PONG.Rect(8,12,12,4,this.color),new PONG.Rect(48,9,8,10,this.color),new PONG.Rect(51,6,17,4,this.color),new PONG.Rect(63,9,8,7,this.color),new PONG.Rect(56,12,7,4,this.color),new PONG.Rect(51,18,17,4,this.color),new PONG.Rect(75,6,17,4,this.color),new PONG.Rect(72,9,8,4,this.color),new PONG.Rect(75,12,17,4,this.color),new PONG.Rect(87,15,8,4,this.color),new PONG.Rect(72,18,20,4,this.color),new PONG.Rect(99,6,17,4,this.color),new PONG.Rect(96,9,8,4,this.color),new PONG.Rect(99,12,17,4,this.color),new PONG.Rect(111,15,8,4,this.color),new PONG.Rect(96,18,20,4,this.color),new PONG.Rect(144,0,8,22,this.color),new PONG.Rect(152,0,15,4,this.color),new PONG.Rect(152,9,12,4,this.color),new PONG.Rect(152,18,15,4,this.color),new PONG.Rect(168,0,8,22,this.color),new PONG.Rect(176,3,3,10,this.color),new PONG.Rect(177,6,5,10,this.color),new PONG.Rect(180,9,4,10,this.color),new PONG.Rect(183,0,8,22,this.color),new PONG.Rect(195,0,20,4,this.color),new PONG.Rect(201,4,8,18,this.color),new PONG.Rect(216,0,8,22,this.color),new PONG.Rect(224,0,15,4,this.color),new PONG.Rect(224,9,12,4,this.color),new PONG.Rect(224,18,15,4,this.color),new PONG.Rect(240,0,8,22,this.color),new PONG.Rect(248,0,12,4,this.color),new PONG.Rect(255,3,8,10,this.color),new PONG.Rect(252,9,5,3,this.color),new PONG.Rect(248,12,9,4,this.color),new PONG.Rect(249,15,11,4,this.color),new PONG.Rect(252,18,11,4,this.color)],this.z=0},PONG.PressEnter.prototype=Object.create(PONG.Entity.prototype),PONG.PressEnter.prototype.constructor=PONG.PressEnter,PONG.OutroTitle=function(){PONG.Entity.apply(this,arguments),this.graphics=[new PONG.Rect(0,12,14,19,this.color),new PONG.Rect(6,6,14,7,this.color),new PONG.Rect(12,0,32,7,this.color),new PONG.Rect(6,30,14,7,this.color),new PONG.Rect(12,36,32,7,this.color),new PONG.Rect(30,25,14,11,this.color),new PONG.Rect(24,18,20,7,this.color),new PONG.Rect(48,12,14,31,this.color),new PONG.Rect(78,12,14,31,this.color),new PONG.Rect(54,6,14,7,this.color),new PONG.Rect(72,6,14,7,this.color),new PONG.Rect(60,0,20,7,this.color),new PONG.Rect(61,24,18,7,this.color),new PONG.Rect(96,0,14,43,this.color),new PONG.Rect(126,0,14,43,this.color),new PONG.Rect(110,6,6,19,this.color),new PONG.Rect(120,6,6,19,this.color),new PONG.Rect(114,12,8,19,this.color),new PONG.Rect(144,0,14,43,this.color),new PONG.Rect(158,0,30,7,this.color),new PONG.Rect(158,18,24,7,this.color),new PONG.Rect(158,36,30,7,this.color),new PONG.Rect(240,6,14,31,this.color),new PONG.Rect(270,6,14,31,this.color),new PONG.Rect(246,0,32,7,this.color),new PONG.Rect(246,36,32,7,this.color),new PONG.Rect(288,0,14,25,this.color),new PONG.Rect(318,0,14,25,this.color),new PONG.Rect(306,24,8,19,this.color),new PONG.Rect(294,18,14,13,this.color),new PONG.Rect(312,18,14,13,this.color),new PONG.Rect(300,31,20,6,this.color),new PONG.Rect(336,0,44,7,this.color),new PONG.Rect(336,36,44,7,this.color),new PONG.Rect(336,7,14,29,this.color),new PONG.Rect(350,18,24,7,this.color),new PONG.Rect(384,0,14,43,this.color),new PONG.Rect(398,0,24,7,this.color),new PONG.Rect(414,6,14,19,this.color),new PONG.Rect(408,18,6,6,this.color),new PONG.Rect(398,24,18,7,this.color),new PONG.Rect(402,30,20,7,this.color),new PONG.Rect(408,36,20,7,this.color)],this.z=0},PONG.OutroTitle.prototype=Object.create(PONG.Entity.prototype),PONG.OutroTitle.prototype.constructor=PONG.OutroTitle,PONG.Game=function(){var a=new PONG.IntroScreen(this);this.setNextScreen=function(b){a=b,a.run()},this.start=function(){a.run()},this.trigger=function(b){a.onEvent(b)}},PONG.IntroScreen=function(a){var b=this;this.game=a,this.foregroundList=PONG.EntityCollection.pull(PONG.categories.INTRO),this.onEvent=function(b){b==PONG.event.START&&PONG.animation.goToSide(function(){a.setNextScreen(new PONG.GameScreen(a))})},this.run=function(){PONG.currentScreen=PONG.screens.INTRO_SCREEN,PONG.displayList=PONG.EntityCollection.pull(PONG.categories.BACKGROUND).concat(b.foregroundList)}},PONG.GameScreen=function(a){this.game=a,this.onEvent=function(b){b==PONG.event.DIE&&a.setNextScreen(new PONG.GameOverScreen(a))},this.run=function(){var a=[],b=PONG.EntityCollection.pull(PONG.categories.BACKGROUND),c=PONG.EntityCollection.pull(PONG.categories.GAME_ENTITIES),d=PONG.EntityCollection.pull(PONG.categories.PLAYER1_POINTS),e=PONG.EntityCollection.pull(PONG.categories.PLAYER2_POINTS);a=b,a=a.concat(c),a=a.concat(d),a=a.concat(e),PONG.displayList=a,PONG.currentScreen=PONG.screens.GAME_SCREEN}},PONG.GameOverScreen=function(a){var b=this;this.game=a,this.foregroundList=PONG.EntityCollection.pull(PONG.categories.OUTRO),this.onEvent=function(b){b==PONG.event.START_OVER&&a.setNextScreen(new PONG.IntroScreen(a))},this.run=function(){PONG.animation.goToFront(),PONG.currentScreen=PONG.screens.GAME_OVER_SCREEN,PONG.displayList=PONG.EntityCollection.pull(PONG.categories.BACKGROUND).concat(b.foregroundList)}},PONG.main=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=0,v={player1:0,player2:0,reset:function(){this.player1=0,this.player2=0}},w="WALL",x="PADDLE",y=function(){var a;return a=e.x<.5*PONG.stageWidth?f:g,e.y>a.y+a.height||e.y+e.height<a.y?w:x},z=function(){e.x<=0?(e.x=0,e.speed.x*=-1,v.player2+=1,H()):e.x>=PONG.stageWidth-e.width&&(e.x=PONG.stageWidth-e.width,e.speed.x*=-1,v.player1+=1,H())},A=function(){e.x<=n?(e.x=n,e.speed.x*=-1,t.play()):e.x>=o-e.width&&(e.x=o-e.width,e.speed.x*=-1,t.play())},B=function(){switch(u+=1/60,e.x+=e.speed.x,e.y+=e.speed.y,f.y+=3*f.direction,f.y<=l&&(f.y=l),f.y>=m-f.height&&(f.y=m-f.height),amplitude=.5*(1+Math.sin(u)),g.y=(m-g.height-l)*amplitude+l,y()){case w:z();break;case x:A()}e.y<=l?(e.y=l,e.speed.y*=-1):e.y>=m-e.height&&(e.y=m-e.height,e.speed.y*=-1)},C=function(){PONG.renderer.render(),PONG.currentScreen==PONG.screens.GAME_SCREEN&&B(),requestAnimationFrame(C)},D=function(){a.trigger(PONG.event.START)},E=function(){s.play(),I(),a.trigger(PONG.event.DIE)},F=function(){a.trigger(PONG.event.START_OVER)},G=function(){0!=v.player1&&(PONG.EntityCollection.pull(PONG.categories.PLAYER1_POINTS)[v.player1-1].rgba={r:255,g:255,b:255,a:255}),0!=v.player2&&(PONG.EntityCollection.pull(PONG.categories.PLAYER2_POINTS)[v.player2-1].rgba={r:255,g:255,b:255,a:255})},H=function(){G(),r.play(),(3==v.player1||3==v.player2)&&E()},I=function(){v.player1=0,v.player2=0,function(){for(var a=PONG.EntityCollection.pull(PONG.categories.PLAYER1_POINTS),b=0,c=a.length;c>b;b++)a[b].rgba={r:0,g:0,b:0,a:0};a=PONG.EntityCollection.pull(PONG.categories.PLAYER2_POINTS);for(var b=0,c=a.length;c>b;b++)a[b].rgba={r:0,g:0,b:0,a:0}}(),H()},J=function(){h.x=140,h.y=150,i.x=159,i.y=240,j.x=159,j.y=272,v.reset(),f.x=0,f.y=p,g.x=o,g.y=p,e.x=.5*(PONG.stageWidth-e.width),e.y=.5*(PONG.stageHeight-e.height),d.y=PONG.stageHeight-d.height,k.x=90,k.y=150,I()},K=function(){q=new Audio("http://www.mathieu-mence.name/misc/pong/intro.wav"),r=new Audio("http://www.mathieu-mence.name/misc/pong/point.wav"),t=new Audio("http://www.mathieu-mence.name/misc/pong/touch.wav"),s=new Audio("http://www.mathieu-mence.name/misc/pong/gameover.wav"),q.play(),h=new PONG.IntroTitle,i=new PONG.Instruction,j=new PONG.PressEnter;for(var u=0,v=i.graphics.length;v>u;u++)i.graphics[u].depth=0;for(var u=0,v=j.graphics.length;v>u;u++)j.graphics[u].depth=0;PONG.EntityCollection.push(h,PONG.categories.INTRO),PONG.EntityCollection.push(i,PONG.categories.INTRO),PONG.EntityCollection.push(j,PONG.categories.INTRO),k=new PONG.OutroTitle,PONG.EntityCollection.push(k,PONG.categories.OUTRO),PONG.EntityCollection.push(j,PONG.categories.OUTRO),c=new PONG.Bound,d=new PONG.Bound,b=new PONG.Scene,PONG.EntityCollection.push(b,PONG.categories.BACKGROUND),PONG.EntityCollection.push(d,PONG.categories.BACKGROUND),PONG.EntityCollection.push(c,PONG.categories.BACKGROUND),e=new PONG.Ball,f=new PONG.Paddle,f.direction=0,g=new PONG.Paddle,PONG.EntityCollection.push(e,PONG.categories.GAME_ENTITIES),PONG.EntityCollection.push(f,PONG.categories.GAME_ENTITIES),PONG.EntityCollection.push(g,PONG.categories.GAME_ENTITIES);for(var u=0,v=3;v>u;u++){var w=new PONG.Point(0,13+7*u,33);w.rgba={r:0,g:0,b:0,a:0},PONG.EntityCollection.push(w,PONG.categories.PLAYER1_POINTS)}for(var u=0,v=3;v>u;u++){var w=new PONG.Point(0,200-(13+7*u)+13,33);w.rgba={r:0,g:0,b:0,a:0},PONG.EntityCollection.push(w,PONG.categories.PLAYER2_POINTS)}l=c.height,m=PONG.stageHeight-d.height,n=f.width,o=PONG.stageWidth-g.width,p=.5*(PONG.stageHeight-f.height),document.onkeypress=function(a){a=a||window.event;var b="number"==typeof a.which?a.which:a.keyCode;if(b)switch(b){case 13:PONG.currentScreen==PONG.screens.INTRO_SCREEN&&D(),PONG.currentScreen==PONG.screens.GAME_OVER_SCREEN&&F();break;case 97:f.direction=-1;break;case 100:f.direction=1}},document.addEventListener("touchstart",function(){switch(PONG.currentScreen){case PONG.screens.INTRO_SCREEN:D();break;case PONG.screens.GAME_SCREEN:0==f.direction&&(f.direction=1),f.direction*=-1;break;case PONG.screens.GAME_OVER_SCREEN:F()}},!0),PONG.renderer=PONG.WebGL3DRenderer(),J(),a=new PONG.Game,a.start(),requestAnimationFrame(C)};return document.addEventListener("DOMContentLoaded",function(){K()}),{init:K,start:D,die:E,startOver:F}}();